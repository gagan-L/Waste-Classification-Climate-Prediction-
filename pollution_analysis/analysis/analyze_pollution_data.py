import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import os

def analyze_pollution_data():
    # Load preprocessed data
    print("Loading preprocessed pollution data...")
    df = pd.read_csv('pollution_analysis/results/preprocessed_pollution_data.csv')
    print("Data loaded successfully.")

    # Display a sample of the data
    print("Sample data:\n", df.head())

    # Plotting total waste generated by country
    plt.figure(figsize=(12, 6))
    top_countries = df.nlargest(10, 'TotalWasteGenerated')
    sns.barplot(data=top_countries, x='CountryName', y='TotalWasteGenerated')
    plt.title("Top 10 Countries by Total Waste Generated")
    plt.xlabel("Country")
    plt.ylabel("Normalized Total Waste Generated")
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()

    # Plotting waste composition by type for a sample country (e.g., "United States")
    country_name = "United States"
    country_data = df[df['CountryName'] == country_name]
    
    if not country_data.empty:
        waste_types = [
            'OrganicWastePercent', 'GlassWastePercent', 
            'MetalWastePercent', 'PaperWastePercent', 'PlasticWastePercent'
        ]
        plt.figure(figsize=(8, 6))
        country_data[waste_types].T.plot(kind='bar', stacked=True, legend=False)
        plt.title(f"Waste Composition in {country_name}")
        plt.ylabel("Percentage")
        plt.xlabel("Waste Type")
        plt.xticks(range(len(waste_types)), waste_types, rotation=45)
        plt.tight_layout()
        plt.show()
    else:
        print(f"No data available for {country_name}.")

# Run the analysis function
if __name__ == "__main__":
    analyze_pollution_data()
